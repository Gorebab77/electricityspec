<head><title></title><meta charset="utf-8"><link rel="stylesheet" href="./styles.css"></head><body class="light-theme blue_sky" style="padding: 20px;"><div class="shine-editor"><h2>[소스설명] - metring.cpp (함수 표 설명)</h2><div><br></div><div><b><span class="shine-text-purple">✅함수들 표로 설명</span></b></div><div><b><span class="shine-text-purple">✅미터링 관련 스래드 함수들</span></b><br></div><div class="shine-table-wrapper"><table><colgroup><col style="width: 40px;"><col style="width: 64px;"><col style="width: 523px;"></colgroup><tbody><tr><td rowspan="3" colspan="1" style="text-align: center;"><h3><b>1</b></h3></td><td><h5 style="text-align: center;"><b>함수명</b></h5></td><td><h5><b>oms_meter_start</b></h5></td></tr><tr><td><h5 style="text-align: center;"><b>요약</b></h5></td><td><h5><b>미터링 관련 스레드 및 큐 초기화</b></h5><h5><b>metering thread, att7053 thread, att7053 ISR thread를 생성하고 메시지 큐를 설정</b></h5></td></tr><tr><td><h5 style="text-align: center;"><b>설명</b></h5></td><td><h5><b>meter, ATT7053, ATT7053 ISR 관련 쓰레드를 생성하고 시작 상태로 진입시킴.</b></h5><h5><b>각각의 메시지 큐 및 쓰레드 핸들 초기화 포함.</b></h5></td></tr></tbody></table></div><div class="shine-table-wrapper"><table><colgroup><col style="width: 40px;"><col style="width: 64px;"><col style="width: 523px;"></colgroup><tbody><tr><td rowspan="3" colspan="1" style="text-align: center;"><h3><b>2</b></h3></td><td><h5 style="text-align: center;"><b>함수명</b></h5></td><td><h5><b>oms_meter_stop</b></h5></td></tr><tr><td><h5 style="text-align: center;"><b>요약</b></h5></td><td><h5><b>모든 미터링 관련 스레드 실행 플래그를 FALSE로 설저앟여 종료 유도</b></h5></td></tr><tr><td><h5 style="text-align: center;"><b>설명</b></h5></td><td><h5>각 쓰레드의 실행 여부 플래그를 FALSE로 설정해 쓰레드 루프 종료를 유도함.</h5></td></tr></tbody></table></div><div class="shine-table-wrapper"><table><colgroup><col style="width: 40px;"><col style="width: 64px;"><col style="width: 523px;"></colgroup><tbody><tr><td rowspan="3" colspan="1" style="text-align: center;"><h3><b>3</b></h3></td><td><h5 style="text-align: center;"><b>함수명</b></h5></td><td><h5><b>oms_meter_Suspend</b></h5></td></tr><tr><td><h5 style="text-align: center;"><b>요약</b></h5></td><td><h5><b>미터링 관련 모든 스레드 정지(suspend)</b></h5></td></tr><tr><td><h5 style="text-align: center;"><b>설명</b></h5></td><td><h5>osThreadSuspend()을 통해 세개의 관련 쓰레드(Meter,ATT7053, ISR)를 일시정지시킴</h5></td></tr></tbody></table></div><div class="shine-table-wrapper"><table><colgroup><col style="width: 40px;"><col style="width: 64px;"><col style="width: 523px;"></colgroup><tbody><tr><td rowspan="3" colspan="1" style="text-align: center;"><h3><b>4</b></h3></td><td><h5 style="text-align: center;"><b>함수명</b></h5></td><td><h5><b>oms_meter_Resume</b></h5></td></tr><tr><td><h5 style="text-align: center;"><b>요약</b></h5></td><td><h5><b>정지된 미터링 관련 스레드 다시 재개 (resume)</b></h5></td></tr><tr><td><h5 style="text-align: center;"><b>설명</b></h5></td><td><h5>osThreadResume()을 통해 정지된 세개의 관련 쓰레드를 다시 실행 상태로 전환함.</h5></td></tr></tbody></table></div><div class="shine-table-wrapper"><table><colgroup><col style="width: 40px;"><col style="width: 64px;"><col style="width: 523px;"></colgroup><tbody><tr><td rowspan="3" colspan="1" style="text-align: center;"><h3><b>5</b></h3></td><td><h5 style="text-align: center;"><b>함수명</b></h5></td><td><h5><b>oms_meter_Action</b></h5></td></tr><tr><td><h5 style="text-align: center;"><b>요약</b></h5></td><td><h5><b>att7053 관련 메시지를 메시지 큐에 추가</b></h5></td></tr><tr><td><h5 style="text-align: center;"><b>설명</b></h5></td><td><h5>ATT7053관련 데이터를 메시지 큐(p_link_Att7053)에 추가하는 함수.<br>외부 이벤트에 호출될 수 있음.</h5></td></tr></tbody></table></div><div><br></div><div><b><span class="shine-text-purple">✅LP Data</span></b><br></div><div class="shine-table-wrapper"><table><colgroup><col style="width: 40px;"><col style="width: 64px;"><col style="width: 523px;"></colgroup><tbody><tr><td rowspan="3" colspan="1" style="text-align: center;"><h3><b>6</b></h3></td><td><h5 style="text-align: center;"><b>함수명</b></h5></td><td><h5><b>push_lp_action_cb</b></h5></td></tr><tr><td><h5 style="text-align: center;"><b>요약</b></h5></td><td><h5><b>LP 데이터 푸시 이벤트 처리 콜백 함수</b></h5></td></tr><tr><td><h5 style="text-align: center;"><b>설명</b></h5></td><td><h5>LP Push가 타이머에 의해 트리거되었을 때 호출되는 콜백<br>현재 시간 정보를 사용해 L_DEVICE_PUSH_LP 메시지를 보냄.</h5></td></tr></tbody></table></div><div class="shine-table-wrapper"><table><colgroup><col style="width: 40px;"><col style="width: 64px;"><col style="width: 523px;"></colgroup><tbody><tr><td rowspan="3" colspan="1" style="text-align: center;"><h3><b>7</b></h3></td><td><h5 style="text-align: center;"><b>함수명</b></h5></td><td><h5><b>push_lp_action</b></h5></td></tr><tr><td><h5 style="text-align: center;"><b>요약</b></h5></td><td><h5><b>DLMS PushSetup 을 기반으로 LP데이터를 푸시하거나 타이머를 설정</b></h5></td></tr><tr><td><h5 style="text-align: center;"><b>설명</b></h5></td><td><h5>DLMS PushSetup의 설정에 따라 즉시 LP전송 또는 일정시간 지연 후 타이머를 통해 전송수행.<br>randomisation delay포함.</h5></td></tr></tbody></table></div><div><b><span class="shine-text-purple">✅ATT7053 미터 주처리 루프</span></b><br></div><div class="shine-table-wrapper"><table><colgroup><col style="width: 40px;"><col style="width: 64px;"><col style="width: 523px;"></colgroup><tbody><tr><td rowspan="3" colspan="1" style="text-align: center;"><h3><b>8</b></h3></td><td><h5 style="text-align: center;"><b>함수명</b></h5></td><td><h5><b>fnMeterProcess</b></h5></td></tr><tr><td><h5 style="text-align: center;"><b>요약</b></h5></td><td><h5><b>metering thread의 주 처리 루프.</b></h5><h5><b>다양한 메시지 타입에 따라 LP저장, TOU업데이트,demand처리 등을 수행</b></h5></td></tr><tr><td><h5 style="text-align: center;"><b>설명</b></h5></td><td><h5>Meter 관련 큐에서 데이터를 수신하여 LP저장, TOU갱신, 전력량계산, 수요전력(demand)누적 등 다양한 계량동작 수행</h5></td></tr></tbody></table></div><div><b><span class="shine-text-purple">✅ATT7053 전력 관련 함수</span></b><br></div><div class="shine-table-wrapper"><table><colgroup><col style="width: 40px;"><col style="width: 64px;"><col style="width: 523px;"></colgroup><tbody><tr><td rowspan="3" colspan="1" style="text-align: center;"><h3><b>9</b></h3></td><td><h5 style="text-align: center;"><b>함수명</b></h5></td><td><h5><b>power_fail_check</b></h5></td></tr><tr><td><h5 style="text-align: center;"><b>요약</b></h5></td><td><h5>ATT7053 전력 실패 감지 및 PF이벤트 발생 조건 확인</h5></td></tr><tr><td><h5 style="text-align: center;"><b>설명</b></h5></td><td><h5>ATT7053칩 상태로부터 PF발생 여부를 감지하고 PF이벤트 발생 여부를 판단하여 PF이벤트 트리거 조건을 체크함.</h5></td></tr></tbody></table></div><div class="shine-table-wrapper"><table><colgroup><col style="width: 40px;"><col style="width: 64px;"><col style="width: 523px;"></colgroup><tbody><tr><td rowspan="3" colspan="1" style="text-align: center;"><h3><b>10</b></h3></td><td><h5 style="text-align: center;"><b>함수명</b></h5></td><td><h5><b>power_fail_check_timer</b></h5></td></tr><tr><td><h5 style="text-align: center;"><b>요약</b></h5></td><td><h5>전력 실패 타이머 콜백. IRQ 기반 power check 요청</h5></td></tr><tr><td><h5 style="text-align: center;"><b>설명</b></h5></td><td><h5>power_fail_check 호출을 타이머에 의해 주기적으로 트리거함.<br>인터럼트 기반이 아닌 polling timer 기반검사.</h5></td></tr></tbody></table></div><div class="shine-table-wrapper"><table><colgroup><col style="width: 40px;"><col style="width: 64px;"><col style="width: 523px;"></colgroup><tbody><tr><td rowspan="3" colspan="1" style="text-align: center;"><h3><b>11</b></h3></td><td><h5 style="text-align: center;"><b>함수명</b></h5></td><td><h5><b>fnPwrChkTimeStartStop</b></h5></td></tr><tr><td><h5 style="text-align: center;"><b>요약</b></h5></td><td><h5><b>power_fail_check 타이머 시작 / 정지.</b></h5></td></tr><tr><td><h5 style="text-align: center;"><b>설명</b></h5></td><td><h5>전력 실패 감지를 위한 타이머 On/Off를 제어하는 함수.<br>g_TimerVOL을 제어함.</h5></td></tr></tbody></table></div><div><b><span class="shine-text-purple">✅ATT7053 미터 관련 함수들</span></b><br></div><div class="shine-table-wrapper"><table><colgroup><col style="width: 40px;"><col style="width: 64px;"><col style="width: 523px;"></colgroup><tbody><tr><td rowspan="3" colspan="1" style="text-align: center;"><h3><b>12</b></h3></td><td><h5 style="text-align: center;"><b>함수명</b></h5></td><td><h5><b>fnAtt7053Process</b></h5></td></tr><tr><td><h5 style="text-align: center;"><b>요약</b></h5></td><td><h5><b>att7053관련 메시지를 처리하는 스레드.<br>레지스터 읽기/쓰기, 캘리브레이션,PF 이벤트처리</b></h5></td></tr><tr><td><h5 style="text-align: center;"><b>설명</b></h5></td><td><h5>ATT7053관련 메시지를 처리하는 쓰레드 루프.<br>측정값 읽기/쓰기, 캘리브레이션 등 처리.<br>메시지 타입에 따라 분기</h5></td></tr></tbody></table></div><div class="shine-table-wrapper"><table><colgroup><col style="width: 40px;"><col style="width: 64px;"><col style="width: 523px;"></colgroup><tbody><tr><td rowspan="3" colspan="1" style="text-align: center;"><h3><b>13</b></h3></td><td><h5 style="text-align: center;"><b>함수명</b></h5></td><td><h5><b>fnAtt7053Isr</b></h5></td></tr><tr><td><h5 style="text-align: center;"><b>요약</b></h5></td><td><h5><b>att7053 인터럽트 처리용 스레드.<br>메시지 큐에서 IRQ 이벤트 수신후 fnAtt7053IrqProcess호출</b></h5></td></tr><tr><td><h5 style="text-align: center;"><b>설명</b></h5></td><td><h5>ATT7053관련 인터럽트 상태를 메시지 큐로부터받아서인터럽트 처리 루틴(fnAtt7053IrqProcess)을 호출함.</h5></td></tr></tbody></table></div><div class="shine-table-wrapper"><table><colgroup><col style="width: 40px;"><col style="width: 64px;"><col style="width: 523px;"></colgroup><tbody><tr><td rowspan="3" colspan="1" style="text-align: center;"><h3><b>14</b></h3></td><td><h5 style="text-align: center;"><b>함수명</b></h5></td><td><h5><b>fnInitMeter</b></h5></td></tr><tr><td><h5 style="text-align: center;"><b>요약</b></h5></td><td><h5><b>미터상태 초기화 함수</b></h5></td></tr><tr><td><h5 style="text-align: center;"><b>설명</b></h5></td><td><h5>Meter Error 구조체 초기화.<br>전류 차단 설정 등 초기값 설정.<br>초기 구동 시점에 호출됨.</h5></td></tr></tbody></table></div><div class="shine-table-wrapper"><table><colgroup><col style="width: 40px;"><col style="width: 64px;"><col style="width: 523px;"></colgroup><tbody><tr><td rowspan="3" colspan="1" style="text-align: center;"><h3><b>15</b></h3></td><td><h5 style="text-align: center;"><b>함수명</b></h5></td><td><h5><b>fnSetErrorState</b></h5></td></tr><tr><td><h5 style="text-align: center;"><b>요약</b></h5></td><td><h5>미터에러 상태 설정 및 디스플레이 오류 코드 갱신</h5></td></tr><tr><td><h5 style="text-align: center;"><b>설명</b></h5></td><td><h5>미터상태 오류비트를 설정하고, 해당오류에 따라 LCD Error Code를 업데이트함.</h5></td></tr></tbody></table></div><div class="shine-table-wrapper"><table><colgroup><col style="width: 40px;"><col style="width: 64px;"><col style="width: 523px;"></colgroup><tbody><tr><td rowspan="3" colspan="1" style="text-align: center;"><h3><b>16</b></h3></td><td><h5 style="text-align: center;"><b>함수명</b></h5></td><td><h5><b>fnGetErrorState</b></h5></td></tr><tr><td><h5 style="text-align: center;"><b>요약</b></h5></td><td><h5>현재 미터 에러상태조회</h5></td></tr><tr><td><h5 style="text-align: center;"><b>설명</b></h5></td><td><h5>현재 설정된 미터 상태 오류값을 반환함</h5></td></tr></tbody></table></div><div class="shine-table-wrapper"><table><colgroup><col style="width: 40px;"><col style="width: 64px;"><col style="width: 523px;"></colgroup><tbody><tr><td rowspan="3" colspan="1" style="text-align: center;"><h3><b>17</b></h3></td><td><h5 style="text-align: center;"><b>함수명</b></h5></td><td><h5><b>fnGetLedOutput</b></h5></td></tr><tr><td><h5 style="text-align: center;"><b>요약</b></h5></td><td><h5>현재 LED 출력 상태 반환</h5></td></tr><tr><td><h5 style="text-align: center;"><b>설명</b></h5></td><td><h5>현재 LED 출력 상태를 반환.<br>디스플레이 출력 모드나 상태에 사용될 수 있음.</h5></td></tr></tbody></table></div><div><br></div><div><br></div><div><b><span class="shine-text-purple">✅송수전 유효, 피상전력 누적</span></b><br></div><div class="shine-table-wrapper"><table><colgroup><col style="width: 40px;"><col style="width: 64px;"><col style="width: 523px;"></colgroup><tbody><tr><td rowspan="3" colspan="1" style="text-align: center;"><h3><b>18</b></h3></td><td><h5 style="text-align: center;"><b>함수명</b></h5></td><td><h5><b>fnDemandAdd_WQ14</b></h5></td></tr><tr><td><h5 style="text-align: center;"><b>요약</b></h5></td><td><h5>수전 유효 전력 누적</h5></td></tr><tr><td><h5 style="text-align: center;"><b>설명</b></h5></td><td><h5>수전 유효 전력 누적 값 WQ14에 값을 더하고 누적된 결과를 반영함.</h5></td></tr></tbody></table></div><div class="shine-table-wrapper"><table><colgroup><col style="width: 40px;"><col style="width: 64px;"><col style="width: 523px;"></colgroup><tbody><tr><td rowspan="3" colspan="1" style="text-align: center;"><h3><b>19</b></h3></td><td><h5 style="text-align: center;"><b>함수명</b></h5></td><td><h5><b>fnDemandAdd_VAQ14</b></h5></td></tr><tr><td><h5 style="text-align: center;"><b>요약</b></h5></td><td><h5>수전 피상 전력 누적</h5></td></tr><tr><td><h5 style="text-align: center;"><b>설명</b></h5></td><td><h5>수전 피상 전력 누적 값 VAQ14에 값을 더하고 누적된 결과를 반환함.</h5></td></tr></tbody></table></div><div class="shine-table-wrapper"><table><colgroup><col style="width: 40px;"><col style="width: 64px;"><col style="width: 523px;"></colgroup><tbody><tr><td rowspan="3" colspan="1" style="text-align: center;"><h3><b>20</b></h3></td><td><h5 style="text-align: center;"><b>함수명</b></h5></td><td><h5><b>fnDemandAdd_WQ23</b></h5></td></tr><tr><td><h5 style="text-align: center;"><b>요약</b></h5></td><td><h5>송전 유효 전력 누적</h5></td></tr><tr><td><h5 style="text-align: center;"><b>설명</b></h5></td><td><h5>송전 유효 전력 누적값 WQ23에 값을 더하고 누적된 결과를 반영함</h5></td></tr></tbody></table></div><div class="shine-table-wrapper"><table><colgroup><col style="width: 40px;"><col style="width: 64px;"><col style="width: 523px;"></colgroup><tbody><tr><td rowspan="3" colspan="1" style="text-align: center;"><h3><b>21</b></h3></td><td><h5 style="text-align: center;"><b>함수명</b></h5></td><td><h5><b>fnDemandAdd_VAQ23</b></h5></td></tr><tr><td><h5 style="text-align: center;"><b>요약</b></h5></td><td><h5>송전 피상 전력 누적</h5></td></tr><tr><td><h5 style="text-align: center;"><b>설명</b></h5></td><td><h5>송전 피상 전력 누적값 VAQ23에 값을 더하고 누적된 결과를 반환함.</h5></td></tr></tbody></table></div><div><b><span class="shine-text-purple">✅Demand</span></b><br></div><div class="shine-table-wrapper"><table><colgroup><col style="width: 40px;"><col style="width: 64px;"><col style="width: 523px;"></colgroup><tbody><tr><td rowspan="3" colspan="1" style="text-align: center;"><h3><b>22</b></h3></td><td><h5 style="text-align: center;"><b>함수명</b></h5></td><td><h5><b>fnDemandCountIncrement</b></h5></td></tr><tr><td><h5 style="text-align: center;"><b>요약</b></h5></td><td><h5>Demand 측정 카운터 증가</h5></td></tr><tr><td><h5 style="text-align: center;"><b>설명</b></h5></td><td><h5>Demand 계량 횟수를 증가 시키고 그 결과를 반영함.</h5></td></tr></tbody></table></div><div class="shine-table-wrapper"><table><colgroup><col style="width: 40px;"><col style="width: 64px;"><col style="width: 523px;"></colgroup><tbody><tr><td rowspan="3" colspan="1" style="text-align: center;"><h3><b>23</b></h3></td><td><h5 style="text-align: center;"><b>함수명</b></h5></td><td><h5><b>fnDemandAdd_All</b></h5></td></tr><tr><td><h5 style="text-align: center;"><b>요약</b></h5></td><td><h5>현재 벡터 상태에 따라 demand&nbsp; 값을 누적 처리</h5></td></tr><tr><td><h5 style="text-align: center;"><b>설명</b></h5></td><td><h5>현재 계량 된 전력 벡터 정보를 기반으로, 각 전력 종류 별 demand 를 누적 저장함.</h5></td></tr></tbody></table></div><div class="shine-table-wrapper"><table><colgroup><col style="width: 40px;"><col style="width: 64px;"><col style="width: 523px;"></colgroup><tbody><tr><td rowspan="3" colspan="1" style="text-align: center;"><h3><b>24</b></h3></td><td><h5 style="text-align: center;"><b>함수명</b></h5></td><td><h5><b>fnGetDemandPulse</b></h5></td></tr><tr><td><h5 style="text-align: center;"><b>요약</b></h5></td><td><h5>현재/과거 demand를 Pulse기준으로 반환.</h5></td></tr><tr><td><h5 style="text-align: center;"><b>설명</b></h5></td><td><h5>누적된 demand 값을 Pulse단위로 환산하여 반환함.<br>last 플래그로 현재 / 과거 선택 가능</h5></td></tr></tbody></table></div><div class="shine-table-wrapper"><table><colgroup><col style="width: 40px;"><col style="width: 64px;"><col style="width: 523px;"></colgroup><tbody><tr><td rowspan="3" colspan="1" style="text-align: center;"><h3><b>25</b></h3></td><td><h5 style="text-align: center;"><b>함수명</b></h5></td><td><h5><b>fnDemandSetDate</b></h5></td></tr><tr><td><h5 style="text-align: center;"><b>요약</b></h5></td><td>Demand날자 설정 및 압축저장</td></tr><tr><td><h5 style="text-align: center;"><b>설명</b></h5></td><td>Demand 기록에 날자를 설정하고 압축된 4바이트 형태로 저장.</td></tr></tbody></table></div><div class="shine-table-wrapper"><table><colgroup><col style="width: 40px;"><col style="width: 64px;"><col style="width: 523px;"></colgroup><tbody><tr><td rowspan="3" colspan="1" style="text-align: center;"><h3><b>26</b></h3></td><td><h5 style="text-align: center;"><b>함수명</b></h5></td><td><h5><b>fnGetDemand</b></h5></td></tr><tr><td><h5 style="text-align: center;"><b>요약</b></h5></td><td>현재 / 과거 demand 값을 기준으로 반환</td></tr><tr><td><h5 style="text-align: center;"><b>설명</b></h5></td><td>누적된 demand 값을 기본 단위로 반환. (Pulse환산전)</td></tr></tbody></table></div><div class="shine-table-wrapper"><table><colgroup><col style="width: 40px;"><col style="width: 64px;"><col style="width: 523px;"></colgroup><tbody><tr><td rowspan="3" colspan="1" style="text-align: center;"><h3><b>27</b></h3></td><td><h5 style="text-align: center;"><b>함수명</b></h5></td><td><h5><b>fnClearDemand</b></h5></td></tr><tr><td><h5 style="text-align: center;"><b>요약</b></h5></td><td>현재 누적된 demand 값을 초기화</td></tr><tr><td><h5 style="text-align: center;"><b>설명</b></h5></td><td>현재 누적된 demand 관련 변수 초기화.<br>demand 재계산 전에 사용됨.</td></tr></tbody></table></div><div class="shine-table-wrapper"><table><colgroup><col style="width: 40px;"><col style="width: 64px;"><col style="width: 523px;"></colgroup><tbody><tr><td rowspan="3" colspan="1" style="text-align: center;"><h3><b>28</b></h3></td><td><h5 style="text-align: center;"><b>함수명</b></h5></td><td><h5><b>fnDemandSetAllToSvr</b></h5></td></tr><tr><td><h5 style="text-align: center;"><b>요약</b></h5></td><td>현재 및 마지막 demand 데이터를 서버에 설정</td></tr><tr><td><h5 style="text-align: center;"><b>설명</b></h5></td><td>현재 및 이전 demand값을 서버 메모리에 반영 (svr_Set_demand 등호출)</td></tr></tbody></table></div><div class="shine-table-wrapper"><table><colgroup><col style="width: 40px;"><col style="width: 64px;"><col style="width: 523px;"></colgroup><tbody><tr><td rowspan="3" colspan="1" style="text-align: center;"><h3><b>29</b></h3></td><td><h5 style="text-align: center;"><b>함수명</b></h5></td><td><h5><b>fnDemandSetDateAndAllToSvr</b></h5></td></tr><tr><td><h5 style="text-align: center;"><b>요약</b></h5></td><td>마지막 demand 날자 기준으로 서버에 demand 설정</td></tr><tr><td><h5 style="text-align: center;"><b>설명</b></h5></td><td>stMeterBackup 구조체에 저장된 마지막 demand 날자 기준으로 서버에 반영<br></td></tr></tbody></table></div><div class="shine-table-wrapper"><table><colgroup><col style="width: 40px;"><col style="width: 64px;"><col style="width: 523px;"></colgroup><tbody><tr><td rowspan="3" colspan="1" style="text-align: center;"><h3><b>30</b></h3></td><td><h5 style="text-align: center;"><b>함수명</b></h5></td><td><h5><b>fnMaxDemandCalculate</b></h5></td></tr><tr><td><h5 style="text-align: center;"><b>요약</b></h5></td><td>누적된 demand 를 기반으로 최대 demand 계산 및 저장</td></tr><tr><td><h5 style="text-align: center;"><b>설명</b></h5></td><td>주어진 시각을 기준으로 최대 demand 계산.<br>현재 demand 값과 비교하여 TOU 구간 별&nbsp; 최대 값 갱신</td></tr></tbody></table></div><div class="shine-table-wrapper"><table><colgroup><col style="width: 40px;"><col style="width: 64px;"><col style="width: 523px;"></colgroup><tbody><tr><td rowspan="3" colspan="1" style="text-align: center;"><h3><b>31</b></h3></td><td><h5 style="text-align: center;"><b>함수명</b></h5></td><td><h5><b>fnMaxDemandSetTime</b></h5></td></tr><tr><td><h5 style="text-align: center;"><b>요약</b></h5></td><td>최대 demand 를 계산할 기준 시간 설정 및 demand 계산 수행.</td></tr><tr><td><h5 style="text-align: center;"><b>설명</b></h5></td><td>현재시각(now time)을 기반으로 demand 구간을 계산하여 다음 구간기준 시각을 생성 후 계산 수행.</td></tr></tbody></table></div><div class="shine-table-wrapper"><table><colgroup><col style="width: 40px;"><col style="width: 64px;"><col style="width: 523px;"></colgroup><tbody><tr><td rowspan="3" colspan="1" style="text-align: center;"><h3><b>32</b></h3></td><td><h5 style="text-align: center;"><b>함수명</b></h5></td><td><h5><b>fnMaxDemandTimeChange</b></h5></td></tr><tr><td><h5 style="text-align: center;"><b>요약</b></h5></td><td>demand peirod 간 시간 차이를 기반으로 demand 계산 시점 결정 및 처리</td></tr><tr><td><h5 style="text-align: center;"><b>설명</b></h5></td><td>이전 demand 계산 시각과 현재 식각을 비교해, 구간 변경 여부를 판별하고 demand 계산 수행 여부 결정</td></tr></tbody></table></div><div class="shine-table-wrapper"><table><colgroup><col style="width: 40px;"><col style="width: 64px;"><col style="width: 523px;"></colgroup><tbody><tr><td rowspan="3" colspan="1" style="text-align: center;"><h3><b>33</b></h3></td><td><h5 style="text-align: center;"><b>함수명</b></h5></td><td><h5><b>fnDemandReset</b></h5></td></tr><tr><td><h5 style="text-align: center;"><b>요약</b></h5></td><td>모든 tariff 의 최대 demand 기록을 초기화</td></tr><tr><td><h5 style="text-align: center;"><b>설명</b></h5></td><td>모든 tariff에 대해 저장된 최대 demand 정보를 초기화함.<br>재설정용으로 사용됨.</td></tr></tbody></table></div><div><br></div><div><b><span class="shine-text-purple">✅Power Factor</span></b><br></div><div class="shine-table-wrapper"><table><colgroup><col style="width: 40px;"><col style="width: 64px;"><col style="width: 523px;"></colgroup><tbody><tr><td rowspan="3" colspan="1" style="text-align: center;"><h3><b>34</b></h3></td><td><h5 style="text-align: center;"><b>함수명</b></h5></td><td><h5><b>fnTouPowerFactorCalculate</b></h5></td></tr><tr><td><h5 style="text-align: center;"><b>요약</b></h5></td><td>TOU 단위의 전력량을 기반으로 power factor 계산</td></tr><tr><td><h5 style="text-align: center;"><b>설명</b></h5></td><td>DLMS TOU 전력량 저옵를 기반으로&nbsp; Power Factor(PF)를 계산하여 구조체에 저장함.</td></tr></tbody></table></div><div class="shine-table-wrapper"><table><colgroup><col style="width: 40px;"><col style="width: 64px;"><col style="width: 523px;"></colgroup><tbody><tr><td rowspan="3" colspan="1" style="text-align: center;"><h3><b>35</b></h3></td><td><h5 style="text-align: center;"><b>함수명</b></h5></td><td><h5><b>fnLpPeriodPowerFactor</b></h5></td></tr><tr><td><h5 style="text-align: center;"><b>요약</b></h5></td><td>LP구간 내의 수전/송전 power factor 계산</td></tr><tr><td><h5 style="text-align: center;"><b>설명</b></h5></td><td>LP기록 내에서 최근 구간 전력량 차이를 이용해 PowerFactor 계산후 저장.</td></tr></tbody></table></div><div><b><span class="shine-text-purple">✅CHANGE Watt → Pulse</span></b><br></div><div class="shine-table-wrapper"><table><colgroup><col style="width: 40px;"><col style="width: 64px;"><col style="width: 523px;"></colgroup><tbody><tr><td rowspan="3" colspan="1" style="text-align: center;"><h3><b>36</b></h3></td><td><h5 style="text-align: center;"><b>함수명</b></h5></td><td><h5><b>fnChangeWattToPulse</b></h5></td></tr><tr><td><h5 style="text-align: center;"><b>요약</b></h5></td><td>Watt값을 pulse 값을 변환</td></tr><tr><td><h5 style="text-align: center;"><b>설명</b></h5></td><td>Watt전력을 pulse 값으로 변환.<br>METER_CONSTANT_VALUE를 곱해 변환함.</td></tr></tbody></table></div><div><b><span class="shine-text-purple">✅NV 메모리&nbsp; 읽기/쓰기</span></b><br></div><div class="shine-table-wrapper"><table><colgroup><col style="width: 40px;"><col style="width: 64px;"><col style="width: 523px;"></colgroup><tbody><tr><td rowspan="3" colspan="1" style="text-align: center;"><h3><b>37</b></h3></td><td><h5 style="text-align: center;"><b>함수명</b></h5></td><td><h5><b>fnCurrentDemandSave</b></h5></td></tr><tr><td><h5 style="text-align: center;"><b>요약</b></h5></td><td>현재 demand 데이터를 NV 메모리에 저장</td></tr><tr><td><h5 style="text-align: center;"><b>설명</b></h5></td><td>현재 누적 demand값을 NV메모리에 저장함.</td></tr></tbody></table></div><div class="shine-table-wrapper"><table><colgroup><col style="width: 40px;"><col style="width: 64px;"><col style="width: 523px;"></colgroup><tbody><tr><td rowspan="3" colspan="1" style="text-align: center;"><h3><b>38</b></h3></td><td><h5 style="text-align: center;"><b>함수명</b></h5></td><td><h5><b>fnCurrentDemandRead</b></h5></td></tr><tr><td><h5 style="text-align: center;"><b>요약</b></h5></td><td>NV메모리에서 현재 demand 데이터를 읽어옴</td></tr><tr><td><h5 style="text-align: center;"><b>설명</b></h5></td><td>NV메모리에서 이전에 저장된 demand 값을 복원해 읽어옴.</td></tr></tbody></table></div><div><b><span class="shine-text-purple">✅ATT7053 IRQ</span></b><br></div><div class="shine-table-wrapper"><table><colgroup><col style="width: 40px;"><col style="width: 64px;"><col style="width: 523px;"></colgroup><tbody><tr><td rowspan="3" colspan="1" style="text-align: center;"><h3><b>39</b></h3></td><td><h5 style="text-align: center;"><b>함수명</b></h5></td><td><h5><b>fnAtt7053IrqHandler</b></h5></td></tr><tr><td><h5 style="text-align: center;"><b>요약</b></h5></td><td>ATT7053 인터럽트가 발생했을 때 메시지 큐에 이벤트 전달</td></tr><tr><td><h5 style="text-align: center;"><b>설명</b></h5></td><td>ATT7053 인터럽트가 발생했을때 인터럽트 처리 루틴 실행을 위해 큐에 메시지 삽입.</td></tr></tbody></table></div><div><br></div><div><b><span class="shine-text-purple"><br></span></b></div><div><br></div></div></body>